@using MessageBusSample.Client.Components.Actions.Rename
@using ReactiveUI
@using MessageBusSample.Client.Components.Actions

@implements IDisposable

@typeparam T


<MudPaper Class="mud-height-full">
    <MudCard Class="mud-height-full">
        <MudCardHeader>
            <MudText Typo="Typo.subtitle2">
                @Title
            </MudText>
        </MudCardHeader>
        <MudCardContent>
            <div class="scrollable-list">
                <MudVirtualize Items="@GetItems()">
                    @ListItemContent(context)
                </MudVirtualize>
            </div>
        </MudCardContent>
    </MudCard>
</MudPaper>


@code {
        [Parameter]
        public string Title { get; set; }

        [Parameter, EditorRequired]
        public Func<List<T>> GetItems { get; set; } = default!;

        [Parameter, EditorRequired]
        public RenderFragment<T> ListItemContent { get; set; } = null!;

        IDisposable? _subscription;

    protected override void OnInitialized()
    {
        _subscription = MessageBus.Current.Listen<ResolvedDeleteActionMessage>().Subscribe(message =>
            {
                InvokeAsync(StateHasChanged);
                Console.WriteLine($"Received ResolvedDeleteActionMessage for {message.EntityId}");
            });

        MessageBus.Current.Listen<ResolveRenameActionMessage>().Subscribe(message =>
        {
            InvokeAsync(StateHasChanged);
            Console.WriteLine($"Received InitRenameActionMessage for doesnt matter");
        });

        base.OnInitialized();
    }

    public void Dispose()
    {
        // Clean up resources
        _subscription?.Dispose();
        Console.WriteLine("Component disposed!");
    }
}
